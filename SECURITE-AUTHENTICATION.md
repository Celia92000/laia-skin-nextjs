# üîê S√©curit√© - Authentification

## ‚úÖ Impl√©mentations termin√©es

### 1. JWT Secret renouvel√©
- **Ancien** : `k7FwPXgH9Zv3mN2qR5tU8yB4xC1aD6eJ0fL9sW2kH7g=` (32 bytes)
- **Nouveau** : `C3pDpi7Z8YPGH5iBPoT10GnxsBKaC8mIzxJ+10g/1q2NwBLk7YSR2JXPfoIVDLtBvzsPZjw/NDlFVev8oH3kiA==` (64 bytes)
- **Fichier** : `.env.local` (ligne 27)

‚ö†Ô∏è **IMPORTANT** : Ne jamais commit ce secret dans Git !

---

### 2. Mots de passe par d√©faut chang√©s

#### Nouveaux identifiants (NOTEZ-LES MAINTENANT !) :

**Super Admin** :
- Email : `superadmin@laiaskin.com`
- Mot de passe : `E=cEYmqzEntyXJc3se&J`
- URL : http://localhost:3001/super-admin

**Admin** (√† cr√©er manuellement si besoin) :
- Email : `admin@laiaskin.com`
- Mot de passe : `A9v*hVrWSG9KeqRA`
- URL : http://localhost:3001/admin

**Clients** :
- 46 clients doivent changer leur mot de passe √† la prochaine connexion

#### Script utilis√© :
- Fichier : `scripts/update-default-passwords.ts`
- Commande : `npx tsx scripts/update-default-passwords.ts`

‚ö†Ô∏è **IMPORTANT** : Supprimez ce script apr√®s utilisation pour des raisons de s√©curit√©

---

### 3. Validation de mots de passe forts

#### Politique de s√©curit√© stricte :
- **Minimum 12 caract√®res**
- Au moins 1 majuscule (A-Z)
- Au moins 1 minuscule (a-z)
- Au moins 1 chiffre (0-9)
- Au moins 1 caract√®re sp√©cial (!@#$%&*...)
- Interdiction des mots de passe courants (password123, admin, etc.)
- Interdiction d'utiliser nom ou email
- D√©tection des patterns r√©p√©titifs (aaa, 123)

#### Fichiers modifi√©s :
- `src/lib/password-validation.ts` (nouveau) - Utilitaire de validation
- `src/app/api/auth/register/route.ts` - Inscription
- `src/app/api/user/change-password/route.ts` - Changement utilisateur
- `src/app/api/admin/change-password/route.ts` - Changement admin

#### Fonctionnalit√©s :
- Score de force (0-100)
- Messages d'erreur d√©taill√©s
- Suggestions d'am√©lioration
- Estimation du temps de crack
- Validation en temps r√©el

---

### 4. V√©rification email obligatoire

#### Impl√©mentation :
- Email automatique envoy√© √† l'inscription
- Token JWT de v√©rification (valide 24h)
- Page de v√©rification d√©di√©e
- Possibilit√© de renvoyer l'email

#### Fichiers cr√©√©s :
- `src/lib/email-verification.ts` - Service de v√©rification
- `src/app/api/auth/verify-email/route.ts` - API
- `src/app/(site)/auth/verify-email/page.tsx` - Page de v√©rification

#### Fonctionnalit√©s :
- Email HTML professionnel avec le branding LAIA
- Lien de v√©rification unique par utilisateur
- Expiration automatique apr√®s 24h
- Protection contre les tokens r√©utilis√©s
- Redirection automatique apr√®s v√©rification

---

## üìã Prochaines √©tapes recommand√©es

### Priorit√© HAUTE :
1. **Ajouter le champ `emailVerified` au schema Prisma**
   ```prisma
   model User {
     // ... autres champs
     emailVerified  Boolean   @default(false)
     emailVerifiedAt DateTime?
   }
   ```

2. **Bloquer la connexion si email non v√©rifi√©**
   - Modifier `/api/auth/login/route.ts`
   - V√©rifier `user.emailVerified === true`

3. **Renouveler les tokens API externes**
   - WhatsApp : EXPIR√â
   - Instagram : Expire le 16 d√©cembre 2025
   - Facebook : Expire le 11 d√©cembre 2025

4. **Passer Stripe en mode PRODUCTION**
   - Remplacer `sk_test_*` par `sk_live_*`
   - Remplacer `pk_test_*` par `pk_live_*`
   - Configurer les webhooks en production

### Priorit√© MOYENNE :
5. **Impl√©menter le rate limiting**
   - Protection contre les attaques par force brute
   - Limiter les tentatives de connexion (5 max / 15 min)
   - Utiliser Upstash Redis (d√©j√† configur√©)

6. **Authentification √† deux facteurs (2FA)**
   - Via SMS ou app authenticator
   - Obligatoire pour super-admin
   - Optionnel pour admin

7. **Logs d'audit de s√©curit√©**
   - Tracer toutes les connexions
   - D√©tecter les connexions suspectes
   - Alertes en temps r√©el

### Priorit√© BASSE :
8. **Session management avanc√©**
   - D√©connexion de tous les appareils
   - Liste des sessions actives
   - Blocage d'appareils suspects

9. **Password breach detection**
   - V√©rifier contre Have I Been Pwned
   - Forcer changement si compromis

10. **Captcha sur inscription/connexion**
    - Protection contre les bots
    - hCaptcha ou reCAPTCHA v3

---

## üß™ Tests √† effectuer

### Tests manuels :
- [ ] S'inscrire avec un mot de passe faible ‚Üí doit √™tre refus√©
- [ ] S'inscrire avec un mot de passe fort ‚Üí doit fonctionner
- [ ] V√©rifier r√©ception de l'email de v√©rification
- [ ] Cliquer sur le lien de v√©rification ‚Üí doit r√©ussir
- [ ] Tenter de se connecter avec ancien mot de passe admin ‚Üí doit √©chouer
- [ ] Se connecter avec nouveau mot de passe super-admin ‚Üí doit fonctionner
- [ ] Changer de mot de passe avec un faible ‚Üí doit √™tre refus√©
- [ ] Changer de mot de passe avec un fort ‚Üí doit fonctionner

### Tests de s√©curit√© :
- [ ] Token de v√©rification expir√© ‚Üí doit √™tre refus√©
- [ ] Token manipul√© ‚Üí doit √™tre refus√©
- [ ] Double utilisation du m√™me token ‚Üí doit √™tre refus√©
- [ ] Tentative de v√©rification d'un autre utilisateur ‚Üí doit √©chouer

---

## üìû Support

En cas de probl√®me :
1. V√©rifier les logs : `console.log` dans les routes API
2. V√©rifier les emails dans Resend dashboard
3. Tester les tokens JWT sur https://jwt.io
4. V√©rifier la base de donn√©es avec Prisma Studio : `npx prisma studio`

---

## üîí Bonnes pratiques

### √Ä FAIRE :
‚úÖ Utiliser un gestionnaire de mots de passe (1Password, Bitwarden, etc.)
‚úÖ Changer les mots de passe tous les 3-6 mois
‚úÖ Utiliser des mots de passe diff√©rents pour chaque service
‚úÖ Activer 2FA partout o√π c'est possible
‚úÖ Ne jamais partager vos identifiants

### √Ä NE PAS FAIRE :
‚ùå Commit des mots de passe dans Git
‚ùå Stocker des mots de passe en clair
‚ùå R√©utiliser le m√™me mot de passe
‚ùå Noter les mots de passe sur papier/post-it
‚ùå Envoyer des mots de passe par email/SMS

---

---

## üîç AUDIT AUTOMATIQUE

Un script de v√©rification automatique est disponible :

```bash
npx tsx scripts/security-check.ts
```

Ce script v√©rifie :
- JWT_SECRET
- Tokens API (WhatsApp, Instagram, Facebook)
- Mode Stripe (test/production)
- Configuration Sentry
- Fichiers de s√©curit√©
- .gitignore

**Score actuel** : 56/100 ‚ö†Ô∏è

**Points critiques identifi√©s** :
- ‚ùå WhatsApp Token EXPIR√â
- ‚ö†Ô∏è  Stripe en mode TEST
- ‚ö†Ô∏è  Sentry non configur√©

---

**Date de mise √† jour** : 22 octobre 2025
**Effectu√© par** : Claude Code
**Statut** : ‚úÖ BASE S√âCURIS√âE - Am√©liorations n√©cessaires
**Prochain audit** : Apr√®s renouvellement tokens API
